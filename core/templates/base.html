{% load static %}

<html>
  <head>

    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap/dist/css/bootstrap.min.css' %}">

    <style type="text/css">
      .vertical-align {
          display: flex;
          align-items: center;
      }
      .center {
          text-align:center;
      }

      .center form {
          display:inline-block;
      }
      .ng-invalid {
        border-color: red;
      }
    </style>

  </head>
  <body data-ng-app="Jogging">

    <div data-ng-view class="container-fluid"></div>

    {% verbatim %}
    <script type="text/ng-template" id="unauthenticated-navbar.html">
      <div class="navbar nabar-default">
        <a class="navbar-brand" data-ng-href="#/">Jogging App</a>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li>
              <a
                data-ng-href="#/signup">Create account</a>
            </li>
          </ul>
        </div>
      </div>
    </script>


    <script type="text/ng-template" id="login.html">
      <div data-ng-include src="'unauthenticated-navbar.html'"></div>
      <div class="row">
        <div class="col-md-9 col-md-offset-3">
          <h2>Login</h2>
          <span
              data-ng-if="loginFailure">Invalid login data</span>
          <form class="form-horizontal col-sm-6" role="form">
            <div class="form-group">
              <label for="username" class="col-sm-2 control-label">Username: </label>
              <div class="col-sm-10">
                <input
                  data-ng-model="loginData.username"
                  class="form-control"
                  type="text" name="username">
              </div>
            </div>
            <div class="form-group">
              <label for="password" class="col-sm-2 control-label">Password: </label>
              <div class="col-sm-10">
                <input
                  data-ng-model="loginData.password"
                  class="form-control"
                  type="password" name="password">
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-2 col-sm-10">
                <button
                  data-ng-click="accountFactory.performLogin(loginData);"
                  class="btn btn-default"
                  type="submit">Login</button>
              </div>
            </div>
          </form>
        </div>
      <div>
    </script>

    <script type="text/ng-template" id="signup.html">
      <div data-ng-include src="'unauthenticated-navbar.html'"></div>
      <div class="row">
        <div class="col-md-9 col-md-offset-3">
          <h2>Create new account</h2>
          <form class="form-horizontal col-sm-6" name="signupForm">
            <div class="form-group">
              <label for="username" class="col-sm-2 control-label">Username: </label>
              <div class="col-sm-10">
                <input
                  data-ng-model="newAccount.username"
                  data-ng-class="{signupForm.username.$error: form-invalid}"
                  class="form-control"
                  type="text" name="username">
              </div>
            </div>
            <div class="form-group">
              <label for="email" class="col-sm-2 control-label">Email: </label>
              <div class="col-sm-10">
                <input
                  data-ng-model="newAccount.email"
                  class="form-control"
                  type="email" name="email">
              </div>
            </div>
            <div class="form-group">
              <label for="password" class="col-sm-2 control-label">Password: </label>
              <div class="col-sm-10">
                <input
                  data-ng-model="newAccount.password"
                  class="form-control"
                  type="password" name="password">
              </div>
            </div>
            <div class="form-group">
              <div class="col-sm-offset-2 col-sm-10">
                <button
                  data-ng-click="accountFactory.createAccount(newAccount);"
                  class="btn btn-default"
                  type="submit">Create</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </script>

    <script type="text/ng-template" id="timings.html">
      <form>
        <label for="time">Time: </label>
        <input
          data-ng-model="createData.formatedTime"
          data-ng-change="createData.time = conversionFactory.from_formated_to_seconds(createData.formatedTime)"
          name="time" type="text">
        <label for="distance">Distance: </label>
        <input
          data-ng-model="createData.distance"
          name="distance" type="number" >
        <label for="date">Date: </label>
        <input
          data-ng-model="createData.date"
          name="date" type="date">
        <button
          data-ng-click="timingsFactory.createTiming(createData); createData = {};">add</button>
      </form>
      <form>
        <label for="startDate">from</label>
        <input
          data-ng-model="filters.start_date"
          type="date" name="startDate">
        <label for="endDate">to</label>
        <input
          data-ng-model="filters.end_date"
          type="date" name="endDate">
        <button
          data-ng-click="timingsFactory.getTimingList(filters);">filter</button>
      </form>
      <ul
        data-ng-init="timingsFactory.getTimingList();">
        <li
          data-ng-repeat="timing in timingsFactory.timings">
          <div
            data-ng-init="status = {editing: false};"
            data-ng-switch="status.editing;">
            <div
              data-ng-switch-when="false">
              <button
                data-ng-click="status.editing = !status.editing">edit</button>
              {{conversionFactory.from_seconds_to_formated(timing.time)}} - {{timing.distance}} - {{timing.date}} - {{timing.distance/timing.time|number:2}} m/s
            </div>
            <div
              data-ng-switch-when="true">
              <form>
                <label for="time">Time: </label>
                <input
                  data-ng-model="updateData.formatedTime"
                  data-ng-init="updateData.formatedTime = conversionFactory.from_seconds_to_formated(timing.time); updateData.time = conversionFactory.from_formated_to_seconds(updateData.formatedTime)"
                  data-ng-change="updateData.time = conversionFactory.from_formated_to_seconds(updateData.formatedTime)"
                  name="formatedTime" type="text">
                <label for="distance">Distance: </label>
                <input
                  data-ng-model="updateData.distance"
                  data-ng-init="updateData.distance = timing.distance;"
                  name="distance" type="text">
                <label for="date">Date: </label>
                <input
                  data-ng-model="updateData.date"
                  data-ng-init="updateData.date = timing.date;"
                  name="date" type="date">
                <button
                  data-ng-click="timingsFactory.updateTiming($index, updateData); status.editing = !status.editing;">save</button>
                <button
                  data-ng-click="status.editing = !status.editing;">cancel</button>
                 ----
                <button
                  data-ng-click="timingsFactory.deleteTiming($index);">delete</button>
              </form>
            </div>
          </div>
        </li>
      </ul>

      <table>
        <tr>
          <td>Week Number</td>
          <td
            data-ng-repeat="(week, timings) in reportsFactory.report">
            {{week}}
          </td>
        </tr>
        <tr>
          <td>Total Distance (m)</td>
          <td
            data-ng-repeat="(week, timings) in reportsFactory.report">
            {{reportsFactory.calculateTotalDistance(timings)}}
          </td>
        </tr>
        <tr>
          <td>Average Speed (m/s)</td>
          <td
            data-ng-repeat="(week, timings) in reportsFactory.report">
            {{reportsFactory.calculateAverageSpeed(timings)|number:2}}
          </td>
        </tr>
      </table>

    </script>
    {% endverbatim %}

    <script type="text/javascript" src='{% static 'angular/angular.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'angular-route/angular-route.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'angular-cookies/angular-cookies.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'lodash/dist/lodash.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'restangular/dist/restangular.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'moment/min/moment-with-locales.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'jquery/dist/jquery.min.js' %}'></script>
    <script type="text/javascript" src='{% static 'bootstrap/dist/js/bootstrap.min.js' %}'></script>

    <script type="text/javascript" src='{% static 'app/main.module.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/accounts/accounts.module.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/accounts/accounts.ctrl.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/accounts/accounts.service.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/timings/timings.module.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/timings/timings.ctrl.js' %}'></script>
    <script type="text/javascript" src='{% static 'app/timings/timings.service.js' %}'></script>
  </body>
</html>
